<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MKT96K5');</script>
    <!-- End Google Tag Manager -->
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Allocating to Default Rules | Sorted Docs </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Allocating to Default Rules | Sorted Docs ">
    <meta name="generator" content="docfx 2.58.9.0">
    
    
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/c4a9dfb254.js" crossorigin="anonymous"></script>
  
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <link rel="stylesheet" href="../../../../styles/theme-switcher.css">
  
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    <meta id="docfx-style:rel" content="../../../../">
    <!--prevent caching the HTML-->
    <meta http-equiv="Cache-Control" content="max-age=31536000">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MKT96K5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar top-bar"></span>
                <span class="icon-bar middle-bar"></span>
                <span class="icon-bar bottom-bar"></span>
              </button>
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" src="../../../../images/sorted_logo.svg" height="auto" width="auto" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar"> 
              <div class="theme-switch-wrapper">
                <label class="theme-switch" for="theme-switcher">
                  <input type="checkbox" id="theme-switcher">
                  <div class="slider round"></div>
                </label>
              </div> 
              <div>
                <form class="navbar-form navbar-right" role="search" id="search">
                    <div class="form-group">
                    <i class="fas fa-search"></i>
                    <input type="text" class="form-control" id="search-query" placeholder="Search our documentation..." autocomplete="off">
                  </div>
                </form>
              </div>
            </div>
          </div>
        </nav>        
        <div class="subnav navbar navbar-default custom">
            <div class="container">
                <div class="row row-nomargin">
                    <div class="hide-when-search col-sm-6" id="breadcrumb">
                        <div class="col-md-6">
                            <ul class="breadcrumb">
                            <li></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>      </header>
      <div class="container body-content">
        
        <div id="search-results" class="tech-docs">
        <div class="row">
            <div class="col-md-12">
                <button id="close-search" type="button" class="btn btn-primary btn-sm"><i class="glyphicon glyphicon-arrow-left"></i>&nbsp;Back</button>
            </div>
        </div>
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10 docs-body" id="docfx-page-content">
            <article class="content wrap" id="_content" data-uid="pro-api-help-shipments-allocating-to-default-rules">
<h1 id="allocating-to-default-rules">Allocating to Default Rules</h1>

<!-- Time to read article - render code -->
<!--
<div class="page-stats row visible-xs">
    <ul class="page-metadata">
        <li class="li-page-date">
            24/02/2021
        </li>
        <li class="li-time-to-read">
             ~4 minutes  to read
        </li>
    </ul>
</div>
<div class="page-stats row visible-sm visible-md visible-lg visible-xl">
    <ul class="page-metadata">
        <li class="li-page-date">
            24/02/2021
        </li>
        <li class="li-time-to-read">
             ~4 minutes  to read
        </li>
        <li class="contributor-li">
            <img src="https://www.gravatar.com/avatar/75aba8f6bb41171675ba3ced4172e9cb.jpg?d=robohash" class="img-circle img-contributor" title="andy.walton@sorted.com"/>
            <span class="tooltip-text">andy.walton@sorted.com</span>
        </li>
        <li class="contributor-li">
            <img src="https://www.gravatar.com/avatar/435f6d0dafb6467a7e20a69f720fb6f1.jpg?d=robohash" class="img-circle img-contributor" title="michael.rose@sorted.com"/>
            <span class="tooltip-text">michael.rose@sorted.com</span>
        </li>
    </ul>
</div>
-->

<div class="page-tags">
    <span class="glyphicon glyphicon-tags"></span>
    <ul class="tags">
        <li class="tag-search">v2</li>
        <li class="tag-search">shipments</li>
        <li class="tag-search">pro</li>
        <li class="tag-search">api</li>
        <li class="tag-search">allocation</li>
        <li class="tag-search">rules</li>
    </ul>
</div>

<p>To page explains how to use the <strong>Allocate Shipment</strong> endpoint to allocate shipments based on your pre-defined allocation rules.</p>
<hr>
<!-- ## Overview

The **Allocate Shipment** and **Allocate Shipments** endpoints enable you to allocate shipments to the cheapest eligible carrier service. PRO selects a service for you when you use these endpoints, rather than requiring you to select a service or service group manually. **Allocate Shipment** allocates a single shipment, while **Allocate Shipments** enables you to queue multiple shipments for allocation at once.-->
<h2 id="allocating-a-single-shipment">Allocating a Single Shipment</h2>
<p>The <strong>Allocate Shipment</strong> endpoint allocates a single shipment to the most appropriate carrier service. To call <strong>Allocate Shipment</strong>, send a <code>PUT</code> request to <code>https://api.sorted.com/pro/shipments/{reference}/allocate</code>, where <code>{reference}</code> indicates the shipment that you want to allocate.</p>
<p>Once the request has been received, PRO uses your shipping rules to determine which carrier services would be eligible to take the shipment, and your shipping modes to determine which of those services the shipment will be allocated to. The system then allocates the shipment and returns an Allocate Result object.</p>
<div class="NOTE">
<h5>Note</h5>
<ul>
<li>For more information on the wider process PRO uses to allocate shipments, see the <a href="allocating_shipments.html#selecting-a-carrier-service">Selecting a Carrier Service</a> section of the <strong>Allocating Shipments</strong> page.</li>
<li>For more information on configuring and using shipping rules, see the <a href="../../../guide/managing-shipping-rules.md">Managing Shipping Rules</a> page of the UI user guide.</li>
<li>For more information on configuring and using shipping modes, see the <a href="../../../guide/managing-shipping-modes.md">Managing Shipping Modes</a> page of the UI user guide.</li>
</ul>
</div>
<p>All PRO endpoints that allocate consignments individually return an Allocate Result object. The Allocate Result contains details of:</p>
<ul>
<li>The shipment's current <code>state</code> following the allocation request. For successful requests this would generally be <em>Allocated</em>.</li>
<li>The carrier and service that the shipment was allocated to.</li>
<li>The <code>price</code> of the allocation.</li>
<li>Any relevant tracking references.</li>
<li>The services that were unable to provide a quote.</li>
<li>The <code>shipping_date</code> and <code>expected_delivery_date</code> for the shipment.</li>
</ul>
<h3 id="allocate-shipment-example">Allocate Shipment Example</h3>
<p>The example shows a successful request to allocate a shipment with a <code>{reference}</code> of <em>sp_01017652898121961272041674506240</em> via the <strong>Allocate Shipment</strong> endpoint. PRO has selected a service and returned <code>tracking_references</code> for the shipment.</p>
<div class="tabGroup" id="tabgroup_bHGHmlrG6S">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_bHGHmlrG6S_allocate-shipment-request" role="tab" aria-controls="tabpanel_bHGHmlrG6S_allocate-shipment-request" data-tab="allocate-shipment-request" tabindex="0" aria-selected="true">Allocate Shipment Request</a>
</li>
<li role="presentation">
<a href="#tabpanel_bHGHmlrG6S_allocate-shipment-response" role="tab" aria-controls="tabpanel_bHGHmlrG6S_allocate-shipment-response" data-tab="allocate-shipment-response" tabindex="-1">Allocate Shipment Response</a>
</li>
</ul>
<section id="tabpanel_bHGHmlrG6S_allocate-shipment-request" role="tabpanel" data-tab="allocate-shipment-request">

<pre><code class="lang-json">PUT https://api.sorted.com/pro/shipments/sp_01017652898121961272041674506240/allocate
</code></pre>
</section>
<section id="tabpanel_bHGHmlrG6S_allocate-shipment-response" role="tabpanel" data-tab="allocate-shipment-response" aria-hidden="true" hidden="hidden">

<pre><code class="lang-json">{
    &quot;shipment_reference&quot;: &quot;sp_01017652898121961272041674506240&quot;,
    &quot;state&quot;: &quot;allocated&quot;,
    &quot;price&quot;: {
        &quot;net&quot;: 2.00,
        &quot;gross&quot;: 2.00,
        &quot;taxes&quot;: [
            {
                &quot;rate&quot;: {
                    &quot;reference&quot;: &quot;FF_DPD_Next_Day_103386&quot;,
                    &quot;country_iso_code&quot;: &quot;GB&quot;,
                    &quot;type&quot;: &quot;Zero&quot;,
                    &quot;value&quot;: 0.0000
                },
                &quot;amount&quot;: 0.000000
            }
        ],
        &quot;currency&quot;: &quot;GBP&quot;
    },
    &quot;message&quot;: &quot;Shipment sp_01017652898121961272041674506240 has been allocated successfully&quot;,
    &quot;carrier&quot;: {
        &quot;reference&quot;: &quot;FF_103386_DPD&quot;,
        &quot;name&quot;: &quot;DPD&quot;,
        &quot;service_reference&quot;: &quot;FF_DPD_Next_Day_103386&quot;,
        &quot;service_name&quot;: &quot;DPD Next Day (Parcel)&quot;
    },
    &quot;tracking_details&quot;: {
        &quot;contents&quot;: [
            {
                &quot;reference&quot;: &quot;sc_01017652898121961272041674506241&quot;,
                &quot;tracking_references&quot;: [
                    &quot;15503566052622&quot;
                ],
                &quot;_links&quot;: []
            },
            {
                &quot;reference&quot;: &quot;sc_01017652898121961272041674506242&quot;,
                &quot;tracking_references&quot;: [
                    &quot;15503566052623&quot;
                ],
                &quot;_links&quot;: []
            }
        ]
    },
    &quot;_links&quot;: [
        {
            &quot;href&quot;: &quot;https://api-int.sorted.com/pro/shipments/sp_01017652898121961272041674506240&quot;,
            &quot;rel&quot;: &quot;shipment&quot;,
            &quot;reference&quot;: &quot;sp_01017652898121961272041674506240&quot;,
            &quot;type&quot;: &quot;shipment&quot;
        },
        {
            &quot;href&quot;: &quot;https://api-int.sorted.com/pro/labels/sp_01017652898121961272041674506240/pdf&quot;,
            &quot;rel&quot;: &quot;label&quot;,
            &quot;reference&quot;: &quot;sp_01017652898121961272041674506240&quot;,
            &quot;type&quot;: &quot;label&quot;
        },
        {
            &quot;href&quot;: &quot;https://api-int.sorted.com/pro/labels/sp_01017652898121961272041674506240/zpl&quot;,
            &quot;rel&quot;: &quot;label&quot;,
            &quot;reference&quot;: &quot;sp_01017652898121961272041674506240&quot;,
            &quot;type&quot;: &quot;label&quot;
        },
        {
            &quot;href&quot;: &quot;https://api.sorted.com/pro/documents/sp_01017652898121961272041674506240&quot;,
            &quot;rel&quot;: &quot;customs_documents&quot;,
            &quot;reference&quot;: &quot;sp_01017652898121961272041674506240&quot;,
            &quot;type&quot;: &quot;all&quot;
        }
    ],
    &quot;correlation_id&quot;: &quot;3ba8481a-7dfc-49ab-8502-e58f98f8fac2.SAPI_28e18db6-2be3-45af-89d7-0e9bb72ae0f2&quot;,
    &quot;details&quot;: [],
    &quot;excluded_services&quot;: [
        {
            &quot;carrier&quot;: {
                &quot;reference&quot;: &quot;FF_FedEx_2Day_977086833&quot;,
                &quot;name&quot;: &quot;FedEx 2 Day&quot;,
                &quot;service_reference&quot;: &quot;FF_FedEx&quot;,
                &quot;service_name&quot;: &quot;FedEx&quot;
            },
            &quot;exclusion&quot;: {
                &quot;reason&quot;: &quot;This service is not available for the selected collection/delivery dates.&quot;,
                &quot;code&quot;: &quot;ex_availability&quot;
            }
        },
        {
            &quot;carrier&quot;: {
                &quot;reference&quot;: &quot;FF_FedEx_2Day_ASR_977086833&quot;,
                &quot;name&quot;: &quot;FedEx 2 Day&quot;,
                &quot;service_reference&quot;: &quot;FF_FedEx&quot;,
                &quot;service_name&quot;: &quot;FedEx&quot;
            },
            &quot;exclusion&quot;: {
                &quot;reason&quot;: &quot;This service is not available for the selected collection/delivery dates.&quot;,
                &quot;code&quot;: &quot;ex_availability&quot;
            }
        }
    ],   
    &quot;applicable_documents&quot;: []
}
</code></pre>
</section>
</div>
<!-- > [!NOTE]
>
>  For full reference information on the **Allocate Shipment** endpoint, see the [PRO v2 API reference](/pro/api/reference/shipments.html#tag/Allocation/paths/~1shipments~1{shipmentReference}~1allocate/put).

 ## Allocating Multiple Shipments At Once

The **Allocate Shipments** endpoint enables you to allocate multiple shipments to the cheapest eligible carrier service. PRO selects a service for you when you use these endpoints, rather than requiring you to select a service or service group manually.

To call **Allocate Shipments**, send a `PUT` request to `https://api.sorted.com/pro/shipments/allocate`. The request body should contain an array of one or more shipment `{reference}`s to be allocated. 

Optionally, you can also include a list of service `capabilities`. If you provide a list of `capabilities`, then PRO only allocates the shipment to a carrier service that meets those capabilities. Each capability should list the `type` of service capability specified and the `value` that that capability should have.

> [!NOTE]
> For information on available service capabilities and values, see the [PRO v2 API reference](/pro/api/reference/shipments.html#tag/Allocation/paths/~1shipments~1allocate/put)

Once the request is received, PRO takes each shipment in turn and attempts to queue it for allocation to the cheapest eligible carrier, as per the process detailed on the [Allocating Shipments](allocating_shipments.md#selecting-a-carrier-service) page. It then returns an Allocate Shipments result. 

[!include[_shipments_allocate_shipments_result](../includes/_shipments_allocate_shipments_result.md)]

### Allocate Shipments Example

The example shows a request to queue three shipments for allocation. Two shipments have been successfully queued, but one was rejected because its `{reference}` could not be found.

# [Allocate Shipments Request](#tab/allocate-shipments-request)

`PUT https://api.sorted.com/pro/shipments/allocate`

```json
    "shipments": [
        "sp_10014418679662051328667654221112",
        "sp_10014418692546953216098308745978",
        "sp_10014418709726822400232323009988"
    ]
```

# [Allocate Shipments Response](#tab/allocate-shipments-response)

```json
{
  "message": "2 shipment(s) queued for allocation successfully. 1 shipment(s) rejected for allocation.",
  "queued": [
    "sp_10014418679662051328667654221112",
    "sp_10014418692546953216098308745978"
  ],
  "rejected": [
    {
      "code": "shipment_not_found",
      "message": "The shipment cannot be found",
      "references": [
        "sp_10014418709726822400232323009988"
      ]
    }
  ],
  "_links": [
    {
      "href": "https://beta.sorted.com/pro/shipments/sp_10014418709726822400232323009988",
      "rel": "shipment",
      "reference": "sp_10014418709726822400232323009988",
      "type": "rejected"
    }
  ]
}
```
---

> [!NOTE]
>
>  For full reference information on the **Allocate Shipments** endpoint, see the [PRO v2 API reference](/pro/api/reference/shipments.html#tag/Allocation/paths/~1shipments~1allocate/put). --> 
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Learn how to retrieve shipment data: <a href="getting_shipments.html">Getting Shipments</a></li>
<li>Learn how to manifest shipments: <a href="manifesting_shipments.html">Manifesting Shipments</a></li>
<li>Learn how to create shipment groups: <a href="allocating_shipments.html">Allocating Shipments</a></li>
</ul>

</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary" id="docfx-side-menu">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Copyright © Sorted Group 2021. Generated by <strong>DocFX</strong></span>
            
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
    <script type="text/javascript" src="../../../../styles/styleswitcher.js"></script>
    <script type="text/javascript" src="../../../../styles/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: false
        });
    
        window.onload = function() {
            const elements = document.getElementsByClassName("lang-mermaid");
            let index = 0;
    
            while (elements.length != 0) {
                let element = elements[0];
                mermaid.render('graph'+ index, element.innerText, (svgGraph) => {
                    element.parentElement.outerHTML = "<div class='mermaid'>" + svgGraph + "</div>";
                });
                index++;
            }
    
            addCodeCopyWrapper();
            identifyStatusCodes();
        };
    
        function addCodeCopyWrapper() {
            document.querySelectorAll('code.hljs').forEach(function (codeBlock) {
    
                var pre = codeBlock.parentNode;
    
                var containingDiv = document.createElement('div');
                containingDiv.className = 'code-copy';
    
                wrap(pre, containingDiv);
            });
            
            if (navigator && navigator.clipboard) {
                addCopyButtons(navigator.clipboard);
            } else {
                var script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js';
                script.integrity = 'sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=';
                script.crossOrigin = 'anonymous';
                script.onload = function() {
                    addCopyButtons(clipboard);
                };
    
                document.body.appendChild(script);
            }
        }
    
        function wrap(el, wrapper) {
            el.parentNode.insertBefore(wrapper, el);
            wrapper.appendChild(el);
        }
    
        function addCopyButtons(clipboard) {
            document.querySelectorAll('pre > code').forEach(function (codeBlock) {
                var button = document.createElement('button');
                button.className = 'copy-code-button';
                button.type = 'button';
    
                button.addEventListener('click', function () {
                    clipboard.writeText(codeBlock.innerText).then(function () {
                        successCopyButtonState(button);
                    }, function (error) {
                        defaultCopyButtonState(button);
                    });
                });
    
                var pre = codeBlock.parentNode;
                if (pre.parentNode.classList.contains('highlight')) {
                    var highlight = pre.parentNode;
                    highlight.parentNode.insertBefore(button, highlight);
                } else {
                    pre.parentNode.insertBefore(button, pre);
                }
    
                defaultCopyButtonState(button);
            });
        }
    
        function defaultCopyButtonState(button) {
    
            button.classList.remove('copy-success');
            button.innerText = '';
    
            var buttonSpanIcon = document.createElement('span');
            buttonSpanIcon.className = 'glyphicon glyphicon-copy';
            var buttonSpanText = document.createElement('span');
            buttonSpanText.innerText = 'Copy';
            buttonSpanText.classList.add('copy');
    
            button.appendChild(buttonSpanIcon);
            button.appendChild(buttonSpanText);
        }
    
        function successCopyButtonState(button) {
            button.blur();
    
            button.innerText = '';
    
            var buttonSpanOkIcon = document.createElement('span');
            buttonSpanOkIcon.className = 'glyphicon glyphicon-ok';
    
            button.appendChild(buttonSpanOkIcon);
    
            button.classList.add('copy-success');
    
            setTimeout(function () {
                defaultCopyButtonState(button);
            }, 2000);
        }
    
        function identifyStatusCodes() {
            document.querySelectorAll('.endpoint code').forEach(function (e) {
                highlightStatusCodes(e);
            });
        }
    
        function highlightStatusCodes(el) {
    
            var codePrefix = el.innerText.substring(0,1);
            
            if (typeof codePrefix === 'undefined' || codePrefix == null) {
                return;
            }
    
            if (codePrefix == "2") {
                el.classList.add('code-success');
                return;
            }
    
            if (codePrefix == "3") {
                el.classList.add('code-warning');
                return;
            }
    
            if (codePrefix == "4" || codePrefix == "5") {
                el.classList.add('code-error');
                return;
            }
        }
    </script>  </body>
</html>
