<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MKT96K5');</script>
    <!-- End Google Tag Manager -->
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Allocating Shipments | Sorted Docs </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Allocating Shipments | Sorted Docs ">
    <meta name="generator" content="docfx 2.58.9.0">
    
    
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/c4a9dfb254.js" crossorigin="anonymous"></script>
  
    <link rel="shortcut icon" href="../../../../favicon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <link rel="stylesheet" href="../../../../styles/theme-switcher.css">
  
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    <meta id="docfx-style:rel" content="../../../../">
    <!--prevent caching the HTML-->
    <meta http-equiv="Cache-Control" content="max-age=31536000">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MKT96K5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar top-bar"></span>
                <span class="icon-bar middle-bar"></span>
                <span class="icon-bar bottom-bar"></span>
              </button>
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" src="../../../../images/sorted_logo.svg" height="auto" width="auto" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar"> 
              <div class="theme-switch-wrapper">
                <label class="theme-switch" for="theme-switcher">
                  <input type="checkbox" id="theme-switcher">
                  <div class="slider round"></div>
                </label>
              </div> 
              <div>
                <form class="navbar-form navbar-right" role="search" id="search">
                    <div class="form-group">
                    <i class="fas fa-search"></i>
                    <input type="text" class="form-control" id="search-query" placeholder="Search our documentation..." autocomplete="off">
                  </div>
                </form>
              </div>
            </div>
          </div>
        </nav>        
        <div class="subnav navbar navbar-default custom">
            <div class="container">
                <div class="row row-nomargin">
                    <div class="hide-when-search col-sm-6" id="breadcrumb">
                        <div class="col-md-6">
                            <ul class="breadcrumb">
                            <li></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>      </header>
      <div class="container body-content">
        
        <div id="search-results" class="tech-docs">
        <div class="row">
            <div class="col-md-12">
                <button id="close-search" type="button" class="btn btn-primary btn-sm"><i class="glyphicon glyphicon-arrow-left"></i>&nbsp;Back</button>
            </div>
        </div>
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10 docs-body" id="docfx-page-content">
            <article class="content wrap" id="_content" data-uid="pro-api-help-shipments-allocating-shipments">
<h1 id="allocating-shipments">Allocating Shipments</h1>

<!-- Time to read article - render code -->
<!--
<div class="page-stats row visible-xs">
    <ul class="page-metadata">
        <li class="li-page-date">
            07/10/2020
        </li>
        <li class="li-time-to-read">
             ~7 minutes  to read
        </li>
    </ul>
</div>
<div class="page-stats row visible-sm visible-md visible-lg visible-xl">
    <ul class="page-metadata">
        <li class="li-page-date">
            07/10/2020
        </li>
        <li class="li-time-to-read">
             ~7 minutes  to read
        </li>
        <li class="contributor-li">
            <img src="https://www.gravatar.com/avatar/75aba8f6bb41171675ba3ced4172e9cb.jpg?d=robohash" class="img-circle img-contributor" title="andy.walton@sorted.com"/>
            <span class="tooltip-text">andy.walton@sorted.com</span>
        </li>
    </ul>
</div>
-->

<div class="page-tags">
    <span class="glyphicon glyphicon-tags"></span>
    <ul class="tags">
        <li class="tag-search">v2</li>
        <li class="tag-search">shipments</li>
        <li class="tag-search">pro</li>
        <li class="tag-search">api</li>
        <li class="tag-search">allocation</li>
    </ul>
</div>

<p>Once you've created a shipment, you'll need to allocate it to a carrier service. This section explains how to configure allocation rules that PRO can use when selecting carrier services, and the various methods you can use to allocate shipments to those services.</p>
<hr>
<h2 id="what-is-allocation">What Is Allocation?</h2>
<p>In the context of SortedPRO, <strong>allocation</strong> is the process of selecting the carrier service that will be used to deliver a shipment. Allocation is a key part of all PRO workflows, as a shipment cannot be shipped if it has not previously been allocated to a suitable carrier service.</p>
<div class="NOTE">
<h5>Note</h5>
<p>You can only allocate shipments that are in a <code>{state}</code> of either <em>unallocated</em> or <em>allocation_failed</em>. If you attempt to allocate a shipment that is not in one of those states, then PRO returns an error.</p>
</div>
<p>To allocate shipments in PRO, you'll need to call one of PRO's allocation endpoints. You can specify a carrier service or service group to allocate to, allocate based on a quote you received, or have PRO select the cheapest eligible carrier service for you. PRO uses pre-defined allocation rules to ensure that your shipment is allocated to a suitable carrier service.</p>
<p>PRO offers the following allocation endpoints:</p>
<ul>
<li><p><strong>Allocate Shipment</strong></p>
<p><code>https://api.sorted.com/pro/shipments/{reference}/allocate</code> - Allocates a single shipment using your default allocation rules.</p>
</li>
<li><p><strong>Allocate Shipment with Carrier Service</strong></p>
<p><code>https://api.sorted.com/pro/shipments/{reference}/allocate/service/{service_ref}</code> - Allocates a single shipment with a specific carrier service.</p>
</li>
<li><p><strong>Allocate with Carrier Service</strong></p>
<p><code>https://api.sorted.com/pro/shipments/allocation/service</code> - Allocates multiple shipments with a specific carrier service.</p>
</li>
<li><p><strong>Allocate Shipment with Service Group</strong></p>
<p><code>https://api.sorted.com/pro/shipments/{reference}/allocate/service_group/{group_ref}</code> - Allocates a single shipment with a carrier service from a specific carrier service group.</p>
</li>
<li><p><strong>Allocate with Service Group</strong></p>
<p><code>https://api.sorted.com/pro/shipments/allocation/service_group</code> - Allocates multiple shipments with a carrier service from a specific carrier service group.</p>
</li>
</ul>
<p>The action PRO takes once the allocation request is received depends on the type of endpoint you used. If you used an endpoint that allocates individual shipments, then PRO allocates the shipment immediately and returns an Allocation Summary listing details of the allocation, such as prices, dates and tracking information. However, if you used an endpoint that can allocate multiple shipments at once, then PRO queues the shipments for allocation at a later time in order to maintain performance. When PRO queues shipments, it returns an Allocate Shipments Result confirming the shipments that were queued.</p>
<div class="NOTE">
<h5>Note</h5>
<p>PRO admins can use the UI to activate and deactivate carrier services from the allocation pool. For more information on activating and deactivating carrier services, see the <a href="../../../guide/managing-shipping-locations.md">Viewing Carrier Services</a> section of the Sorted Admin Portal Guide.</p>
</div>
<p>When a shipment is allocated to a carrier service, its status changes to <em>allocated</em>, enabling you to retrieve its package labels and (where applicable) customs documentation.</p>
<div class="TIP">
<h5>Tip</h5>
<p>When you allocate an <code>on-demand</code> shipment, PRO automatically books a collection as a background process. You do not need to specify <code>on_demand</code> booking details manually.</p>
</div>
<h2 id="selecting-a-carrier-service">Selecting a Carrier Service</h2>
<p>Most allocation endpoints require PRO to select a carrier service from a range of potential options. PRO uses the following process to select carrier services:</p>
<ol>
<li><strong>Who can meet the request type?</strong> - First, PRO creates a pool of carrier services that could potentially meet the terms of the allocation request. The results returned by this step depend heavily on the allocation endpoint used. For example, an <strong>Allocate with Service Group</strong> request limits PRO to only those shipments in a particular service group, whereas an <strong>Allocate Shipment</strong> request does not limit the pool of available services in itself and could potentially include any carrier service.</li>
<li><strong>Who can deliver?</strong> - Next, PRO takes the details of the shipment into account, eliminating any carrier services that could not take the shipment (for example, because they do not ship to the delivery address or they could meet any specified shipping and delivery dates).</li>
<li><strong>Who meets the shipping rules?</strong> - Next, PRO creates a final shortlist of carrier services by eliminating any services that do not meet your organisation's allocation rules.</li>
<li><strong>Who meets the selected shipping mode?</strong> - Finally, PRO uses shipping modes to determine which of the remaining carrier services the shipment should be allocated to. By default, PRO uses a &quot;cheapest carrier&quot; shipping mode, in which the system allocates the shipment to the cheapest carrier service that meets the allocation rules.</li>
</ol>
<div class="NOTE">
<h5>Note</h5>
<p>Certain carriers may specify their own rules in order to filter out which shipments can be allocated to a particular service. For example, some carriers require a package description when shipping internationally, and will not allow their services to be allocated to a international shipment that does not have the correct description. PRO automatically takes these rules into account when allocating shipments.</p>
</div>
<h2 id="what-is-a-shipping-rule">What Is a Shipping Rule?</h2>
<p>When you make an allocation request, PRO uses its shipping rules to ascertain which carrier services are &quot;eligible&quot; to take the shipments in question and which are not.</p>
<p>PRO shipment rules exist as a pre-defined set of specifications, based on shipment parameters and attributes. These specifications are then linked to carrier services and shipping locations to create a rule. A rule can either <em>include</em> shipments (e.g. &quot;The linked carrier services are available when a shipment's weight is between 10 and 15 kg&quot;) or <em>exclude</em> shipments (e.g. &quot;The linked carrier services are available <strong>unless</strong> a shipment's weight is between 10 and 15 kg&quot;).</p>
<p>When PRO allocates a shipment, it examines the rules linked to each of its carrier services and excludes any services whose linked rulesets would prevent that service from taking the shipment.</p>
<p>Some use cases for shipment rules include:</p>
<ul>
<li>Always shipping high-value items with a particular carrier service.</li>
<li>Only using specific carrier services to ship to a particular country or group of countries.</li>
<li>Never using a particular carrier service from a particular shipping location (for example, due to high shipping costs or previous customer service issues).</li>
</ul>

<div class="NOTE">
<h5>Note</h5>
<p>For more information on configuring and using shipping rules, see the <a href="../../../guide/managing-shipping-rules.md">Managing Shipping Rules</a> page of the UI user guide.</p>
</div>
<h2 id="what-is-a-shipping-mode">What Is a Shipping Mode?</h2>
<p>In PRO, a shipping mode is a preconfigured shipping pattern. When allocating shipments, PRO uses shipping modes to determine the most appropriate eligible carrier service to allocate the shipment to at that particular point in time. Configuring shipping modes can help you to deal with carrier shipping volume restrictions (i.e. during peak hours) and avoid penalties for insufficient trailer fills without the need for manual intervention.</p>
<p>Shipping modes are closely related to shipping rules, which are also used during the allocation process as a means of selecting a carrier service. It's important to know the difference between shipping rules and shipping modes:</p>
<ul>
<li><p>Shipping <strong>rules</strong> are business rules that determine which of your enabled carrier services would be eligible to take a shipment. For example, you could use shipping rules to set a condition that <em>&quot;Only carrier services A, B, and, D can take shipments with a value of over £100&quot;</em></p>
</li>
<li><p>Shipping <strong>modes</strong> are patterns that determine which eligible carrier services the shipment will be allocated to. For example, a shipping mode might be used to configure allocation limits on your carrier services, with PRO allocating to the cheapest service that has not reached its limit.</p>
<p>Continuing from the example above, PRO could combine the shipping rule and shipping mode effectively say <em>&quot;From the pool of eligible carrier services (A,B, and D), A has reached its daily allocation limit, B would cost £10 to ship the goods, and D would cost £5 to ship the goods. Therefore, allocate the shipment to carrier service D. &quot;</em></p>
</li>
</ul>
<p>PRO shipping modes enable you to specify allocation limits with custom time ranges, which can be applied to both carrier services and shipping locations.</p>

<div class="NOTE">
<h5>Note</h5>
<p>For more information on configuring and using shipping modes, see the <a href="../../../guide/managing-shipping-modes.md">Managing Shipping Modes</a> page of the UI user guide.</p>
</div>
<!-- ### Using Dangerous Goods Rules

PRO version 2 enables you to manage which carrier services can carry which types of dangerous goods by setting up "dangerous goods rulesets" in the UI. This is a change from PRO version 1's consignments-based implementation, in which dangerous goods specifications are directly tied in to each carrier service.

When setting up dangerous goods rules, you configure a ruleset independently of any carrier services and then link those rules to the services you require. This is especially useful if you have non-standard agreements with your carriers (that is, carriers will allow you to ship dangerous goods on a carrier service that would not normally take that class of goods).

When allocating shipments, PRO takes your dangerous goods rulesets into account as part of its allocation rule checks. Any service that does not meet the rules is excluded.

<!--<span class="commented-out">INSTRUCTIONS FOR SETTING UP RULESETS IN HERE (WHEN IT'S IN THE UI)</span>-->
<h2 id="allocation-section-contents">Allocation Section Contents</h2>
<ul>
<li><a href="allocating_to_default_rules.html">Allocating to Default Rules</a> - Explains how to allocate shipments based on your pre-defined allocation rules.</li>
<li><a href="allocating_with_a_specific_carrier_service.html">Allocating with a Specific Carrier Service</a> - Explains how to allocate shipments with a specific carrier service.</li>
<li><a href="allocating_within_a_carrier_service_group.html">Allocating Within a Carrier Service Group</a> - Explains how to allocate shipments with a carrier service from a specific carrier service group.</li>
</ul>

</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary" id="docfx-side-menu">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Copyright © Sorted Group 2021. Generated by <strong>DocFX</strong></span>
            
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
    <script type="text/javascript" src="../../../../styles/styleswitcher.js"></script>
    <script type="text/javascript" src="../../../../styles/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: false
        });
    
        window.onload = function() {
            const elements = document.getElementsByClassName("lang-mermaid");
            let index = 0;
    
            while (elements.length != 0) {
                let element = elements[0];
                mermaid.render('graph'+ index, element.innerText, (svgGraph) => {
                    element.parentElement.outerHTML = "<div class='mermaid'>" + svgGraph + "</div>";
                });
                index++;
            }
    
            addCodeCopyWrapper();
            identifyStatusCodes();
        };
    
        function addCodeCopyWrapper() {
            document.querySelectorAll('code.hljs').forEach(function (codeBlock) {
    
                var pre = codeBlock.parentNode;
    
                var containingDiv = document.createElement('div');
                containingDiv.className = 'code-copy';
    
                wrap(pre, containingDiv);
            });
            
            if (navigator && navigator.clipboard) {
                addCopyButtons(navigator.clipboard);
            } else {
                var script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js';
                script.integrity = 'sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=';
                script.crossOrigin = 'anonymous';
                script.onload = function() {
                    addCopyButtons(clipboard);
                };
    
                document.body.appendChild(script);
            }
        }
    
        function wrap(el, wrapper) {
            el.parentNode.insertBefore(wrapper, el);
            wrapper.appendChild(el);
        }
    
        function addCopyButtons(clipboard) {
            document.querySelectorAll('pre > code').forEach(function (codeBlock) {
                var button = document.createElement('button');
                button.className = 'copy-code-button';
                button.type = 'button';
    
                button.addEventListener('click', function () {
                    clipboard.writeText(codeBlock.innerText).then(function () {
                        successCopyButtonState(button);
                    }, function (error) {
                        defaultCopyButtonState(button);
                    });
                });
    
                var pre = codeBlock.parentNode;
                if (pre.parentNode.classList.contains('highlight')) {
                    var highlight = pre.parentNode;
                    highlight.parentNode.insertBefore(button, highlight);
                } else {
                    pre.parentNode.insertBefore(button, pre);
                }
    
                defaultCopyButtonState(button);
            });
        }
    
        function defaultCopyButtonState(button) {
    
            button.classList.remove('copy-success');
            button.innerText = '';
    
            var buttonSpanIcon = document.createElement('span');
            buttonSpanIcon.className = 'glyphicon glyphicon-copy';
            var buttonSpanText = document.createElement('span');
            buttonSpanText.innerText = 'Copy';
            buttonSpanText.classList.add('copy');
    
            button.appendChild(buttonSpanIcon);
            button.appendChild(buttonSpanText);
        }
    
        function successCopyButtonState(button) {
            button.blur();
    
            button.innerText = '';
    
            var buttonSpanOkIcon = document.createElement('span');
            buttonSpanOkIcon.className = 'glyphicon glyphicon-ok';
    
            button.appendChild(buttonSpanOkIcon);
    
            button.classList.add('copy-success');
    
            setTimeout(function () {
                defaultCopyButtonState(button);
            }, 2000);
        }
    
        function identifyStatusCodes() {
            document.querySelectorAll('.endpoint code').forEach(function (e) {
                highlightStatusCodes(e);
            });
        }
    
        function highlightStatusCodes(el) {
    
            var codePrefix = el.innerText.substring(0,1);
            
            if (typeof codePrefix === 'undefined' || codePrefix == null) {
                return;
            }
    
            if (codePrefix == "2") {
                el.classList.add('code-success');
                return;
            }
    
            if (codePrefix == "3") {
                el.classList.add('code-warning');
                return;
            }
    
            if (codePrefix == "4" || codePrefix == "5") {
                el.classList.add('code-error');
                return;
            }
        }
    </script>  </body>
</html>
