<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MKT96K5');</script>
    <!-- End Google Tag Manager -->
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Calculated Events | Sorted Docs </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Calculated Events | Sorted Docs ">
    <meta name="generator" content="docfx 2.58.9.0">
    
    
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/c4a9dfb254.js" crossorigin="anonymous"></script>
  
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <link rel="stylesheet" href="../../styles/theme-switcher.css">
  
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    <meta id="docfx-style:rel" content="../../">
    <!--prevent caching the HTML-->
    <meta http-equiv="Cache-Control" content="max-age=31536000">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MKT96K5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar top-bar"></span>
                <span class="icon-bar middle-bar"></span>
                <span class="icon-bar bottom-bar"></span>
              </button>
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" src="../../images/sorted_logo.svg" height="auto" width="auto" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar"> 
              <div class="theme-switch-wrapper">
                <label class="theme-switch" for="theme-switcher">
                  <input type="checkbox" id="theme-switcher">
                  <div class="slider round"></div>
                </label>
              </div> 
              <div>
                <form class="navbar-form navbar-right" role="search" id="search">
                    <div class="form-group">
                    <i class="fas fa-search"></i>
                    <input type="text" class="form-control" id="search-query" placeholder="Search our documentation..." autocomplete="off">
                  </div>
                </form>
              </div>
            </div>
          </div>
        </nav>        
        <div class="subnav navbar navbar-default custom">
            <div class="container">
                <div class="row row-nomargin">
                    <div class="hide-when-search col-sm-6" id="breadcrumb">
                        <div class="col-md-6">
                            <ul class="breadcrumb">
                            <li></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>      </header>
      <div class="container body-content">
        
        <div id="search-results" class="tech-docs">
        <div class="row">
            <div class="col-md-12">
                <button id="close-search" type="button" class="btn btn-primary btn-sm"><i class="glyphicon glyphicon-arrow-left"></i>&nbsp;Back</button>
            </div>
        </div>
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10 docs-body" id="docfx-page-content">
            <article class="content wrap" id="_content" data-uid="react-help-calc-events">
<h1 id="calculated-events">Calculated Events</h1>

<!-- Time to read article - render code -->
<!--
<div class="page-stats row visible-xs">
    <ul class="page-metadata">
        <li class="li-page-date">
            29/05/2020
        </li>
        <li class="li-time-to-read">
             ~5 minutes  to read
        </li>
    </ul>
</div>
<div class="page-stats row visible-sm visible-md visible-lg visible-xl">
    <ul class="page-metadata">
        <li class="li-page-date">
            29/05/2020
        </li>
        <li class="li-time-to-read">
             ~5 minutes  to read
        </li>
        <li class="contributor-li">
            <img src="https://www.gravatar.com/avatar/75aba8f6bb41171675ba3ced4172e9cb.jpg?d=robohash" class="img-circle img-contributor" title="andy.walton@sorted.com"/>
            <span class="tooltip-text">andy.walton@sorted.com</span>
        </li>
        <li class="contributor-li">
            <img src="https://www.gravatar.com/avatar/435f6d0dafb6467a7e20a69f720fb6f1.jpg?d=robohash" class="img-circle img-contributor" title="michael.rose@sorted.com"/>
            <span class="tooltip-text">michael.rose@sorted.com</span>
        </li>
    </ul>
</div>
-->

<div class="page-tags">
    <span class="glyphicon glyphicon-tags"></span>
    <ul class="tags">
        <li class="tag-search">react</li>
        <li class="tag-search">api</li>
        <li class="tag-search">calculated events</li>
        <li class="tag-search">events</li>
    </ul>
</div>

<p>REACT's Calculated Events feature helps you to stay on top of shipments that may have gone missing, or which have passed their delivery promise date. This page explains the shipment properties that REACT can calculate, how calculated events work, and how best to use calculated events</p>
<hr>
<h2 id="what-is-a-calculated-event">What is a Calculated Event?</h2>
<p>A calculated event is an event that is generated by REACT's internal processing, rather than as a result of an external tracking update.</p>
<p>Each shipment has two properties that REACT can change without receiving a carrier tracking update. They are:</p>
<ul>
<li><code>may_be_missing</code> - Indicates whether REACT believes that the shipment may be missing. REACT marks shipments as <code>may_be_missing</code> if they are not updated within a set time period after registration, or if they are not marked as delivered, lost, or refused within a different set time period.</li>
<li><code>lateness</code>. Contains two sub-properties - <code>lateness.is_late</code> and <code>lateness.hours_late</code>. These properties indicate whether REACT believes a shipment to be late, and (where applicable) how many hours late this shipment is.</li>
</ul>
<p>When REACT updates one of these properties, it creates a calculated event to record the change. You can retrieve calculated events in the same way you would retrieve regular, carrier-derived events.</p>
<div class="NOTE">
<h5>Note</h5>
<p>For more information on retrieving events, see the <a href="retrieving-data.html">Retrieving Shipment and Event Data</a> page of the docs portal, and the <a href="https://docs.sorted.com/react/api/#GetShipmentEvents">Get Shipment Events</a> section of the API reference.</p>
</div>
<h2 id="may-be-missing">May Be Missing</h2>
<p>If REACT believes that a shipment may be lost, it sets that shipment's <code>may_be_missing</code> property to <em>true</em>. By default, the <code>may_be_missing</code> property is set to <em>false</em>.</p>
<div class="CAUTION">
<h5>Caution</h5>
<p><code>may_be_missing</code> is always set based on REACT's internal calculations. A <code>may_be_missing</code> value of <em>true</em> does not mean that the carrier has notified Sorted that the shipment may be missing.</p>
</div>
<p>REACT sets a shipment's <code>may_be_missing</code> property to <em>true</em> if either of the following conditions are met:</p>
<p><strong>Condition 1</strong></p>
<p>No state changing tracking event has been received for that shipment within 12 hours of the shipment being registered with REACT (as recorded in the <code>created_on</code> property) <strong>OR</strong> within 12 hours of the <code>shipped_date</code> (whichever is earlier). Note that <code>shipped_date</code> is an optional field.</p>
<p><strong>Condition 2</strong></p>
<p>All of the following conditions are met:</p>
<ul>
<li>The shipment has never been in any of the <a href="calc-events.html#final-states">final states</a>.</li>
<li>The shipment has a country ISO code registered for both its origin and destination addresses (via the <code>addresses.country_iso_code</code> property).</li>
<li>It has been more than 24 hours since a tracking event was received for a domestic shipment, <strong>OR</strong> more than 72 hours since a tracking event was received for an international shipment.</li>
</ul>
<p>Shipments are classed as domestic if their origin and destination <code>addresses.country_iso_code</code> is identical. Otherwise, they are classified as international.</p>
<h2 id="late">Late</h2>
<p>The <code>lateness.is_late</code> property denotes whether REACT believes a shipment to be late. By default, the <code>is_late</code> property is set to <em>false</em>. REACT sets <code>is_late</code> to <em>true</em> if all of the following conditions are met:</p>
<ul>
<li>The shipment has a <code>promised_date</code> recorded.</li>
<li>The date and time recorded in <code>promised_date</code> has elapsed.</li>
<li>The shipment did not enter any of the <a href="calc-events.html#final-states">final states</a> before the <code>promised_date</code> elapsed.</li>
</ul>
<p>If a shipment does not have a <code>promised_date</code> recorded, then REACT cannot perform <code>lateness</code> calculations for that shipment.</p>
<p>If a shipment is marked as late, then REACT records how many hours late it is in the <code>lateness.hours_late</code> property. This information is refreshed every time the shipment is retrieved from the Tracking, Shipment or Events APIs.</p>
<p>The <code>is_late</code> flag is reset if the shipment is updated with new <code>promised_date</code> information (as long as the new <code>promised_date</code> has not also already elapsed). If <code>is_late</code> is reset to <em>false</em>, then <code>hours_late</code> is reset to NULL.</p>
<div class="NOTE">
<h5>Note</h5>
<p>The <code>is_late</code> shipment property should not be confused with the <em>Late</em> shipment state. Like all other shipment states, the <em>Late</em> shipment state is assigned on the basis of a carrier tracking event that REACT has received. Simply put, the <code>is_late</code> property is used when REACT notices a shipment is late, while the <em>Late</em> shipment state is used when a carrier tells Sorted that the shipment is late.</p>
</div>
<h3 id="trackable-shipments">Trackable Shipments</h3>
<p>To optimise performance, REACT periodically marks old shipments as &quot;non-trackable&quot;. The system only performs <code>may_be_missing</code> and <code>lateness</code> calculations on trackable shipments.</p>
<p>A shipment is deemed to be non-trackable if any of the following criteria are met:</p>
<ul>
<li>The shipment is domestic (i.e. the <code>addresses.country_iso_code</code> of its origin and destination addresses is identical) <strong>AND</strong> Sorted has not received a tracking event for it in seven or more days.</li>
<li>The shipment is international (i.e. the <code>addresses.country_iso_code</code> of its origin and destination addresses is different) <strong>AND</strong> Sorted has not received a tracking event for it in 10 or more days.
<div class="NOTE">
<h5>Note</h5>
<p>If Sorted do not know whether a shipment is domestic or international (that is, it does not have a <code>addresses.country_iso_code</code> recorded for both its origin and destination addresses), then it is assumed to be domestic.</p>
</div>
</li>
<li>The shipment is in a <a href="calc-events.html#final-states">final state</a> <strong>AND</strong> Sorted has not received a tracking event for it in three or more days.</li>
</ul>
<h2 id="final-states">Final States</h2>
<p>REACT uses &quot;final shipment states&quot; when determining whether shipments are lost or potentially missing. The list of final states covers all the potential outcomes for a shipment delivery. Once a shipment enters a final state, its journey is considered to have ended and REACT no longer tracks it.</p>
<p>The full list of final states is:</p>
<ul>
<li>delivered</li>
<li>delivered_damaged</li>
<li>delivered_to_neighbour</li>
<li>delivered_to_reception</li>
<li>delivered_to_safe_location</li>
<li>destroyed</li>
<li>lost</li>
<li>carrier_refused_to_collect</li>
<li>carrier_unable_to_collect</li>
<li>delivered</li>
<li>delivery_failed</li>
<li>delivery_failed_card_left</li>
<li>delivery_refused</li>
<li>delivery_rescheduled</li>
<li>exchange_failed</li>
<li>partially_delivered</li>
<li>proof_of_delivery_available</li>
<li>ready_for_collection</li>
</ul>
<h2 id="using-calculated-properties">Using Calculated Properties</h2>
<p>Although set by REACT, the <code>lateness</code> and <code>may_be_missing</code> flags are standard properties and can be integrated in exactly the same way as any other shipment data. They are returned by the Shipments and Events APIs,as part of the Shipment and Shipment Events resources.</p>
<div class="NOTE">
<h5>Note</h5>
<p>For more information on retrieving data via REACT's APIs, see the <a href="retrieving-data.html">Retrieving Shipment and Event Data</a> page.</p>
</div>
<h2 id="viewing-calculated-properties-in-the-ui">Viewing Calculated Properties in the UI</h2>
<p>The UI's <strong>Calculated Events</strong> dashboard displays the number of your shipments that REACT has flagged as <em>Late</em> or <em>May Be Missing</em>. To open the <strong>Calculated Events</strong> dashboard, select the <strong>Dashboards &gt; Calculated Events</strong> menu option.</p>
<p><img src="images/calc-events-dash.png" alt="calc-events-dash"></p>
<div class="NOTE">
<h5>Note</h5>
<p>For more information on monitoring shipments in the REACT UI, see the <a href="monitoring-shipments.md">Monitoring Shipments</a> page.</p>
</div>
<h2 id="next-steps">Next Steps</h2>
<p>Learn more about integrating with REACT:</p>
<ul>
<li><a href="registering-shipments.html">Registering Shipments</a></li>
<li><a href="updating-shipments.html">Updating Shipments</a></li>
<li><a href="error-codes.html">Error Codes</a></li>
</ul>

</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary" id="docfx-side-menu">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Copyright © Sorted Group 2021. Generated by <strong>DocFX</strong></span>
            
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
    <script type="text/javascript" src="../../styles/styleswitcher.js"></script>
    <script type="text/javascript" src="../../styles/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: false
        });
    
        window.onload = function() {
            const elements = document.getElementsByClassName("lang-mermaid");
            let index = 0;
    
            while (elements.length != 0) {
                let element = elements[0];
                mermaid.render('graph'+ index, element.innerText, (svgGraph) => {
                    element.parentElement.outerHTML = "<div class='mermaid'>" + svgGraph + "</div>";
                });
                index++;
            }
    
            addCodeCopyWrapper();
            identifyStatusCodes();
        };
    
        function addCodeCopyWrapper() {
            document.querySelectorAll('code.hljs').forEach(function (codeBlock) {
    
                var pre = codeBlock.parentNode;
    
                var containingDiv = document.createElement('div');
                containingDiv.className = 'code-copy';
    
                wrap(pre, containingDiv);
            });
            
            if (navigator && navigator.clipboard) {
                addCopyButtons(navigator.clipboard);
            } else {
                var script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/clipboard-polyfill/2.7.0/clipboard-polyfill.promise.js';
                script.integrity = 'sha256-waClS2re9NUbXRsryKoof+F9qc1gjjIhc2eT7ZbIv94=';
                script.crossOrigin = 'anonymous';
                script.onload = function() {
                    addCopyButtons(clipboard);
                };
    
                document.body.appendChild(script);
            }
        }
    
        function wrap(el, wrapper) {
            el.parentNode.insertBefore(wrapper, el);
            wrapper.appendChild(el);
        }
    
        function addCopyButtons(clipboard) {
            document.querySelectorAll('pre > code').forEach(function (codeBlock) {
                var button = document.createElement('button');
                button.className = 'copy-code-button';
                button.type = 'button';
    
                button.addEventListener('click', function () {
                    clipboard.writeText(codeBlock.innerText).then(function () {
                        successCopyButtonState(button);
                    }, function (error) {
                        defaultCopyButtonState(button);
                    });
                });
    
                var pre = codeBlock.parentNode;
                if (pre.parentNode.classList.contains('highlight')) {
                    var highlight = pre.parentNode;
                    highlight.parentNode.insertBefore(button, highlight);
                } else {
                    pre.parentNode.insertBefore(button, pre);
                }
    
                defaultCopyButtonState(button);
            });
        }
    
        function defaultCopyButtonState(button) {
    
            button.classList.remove('copy-success');
            button.innerText = '';
    
            var buttonSpanIcon = document.createElement('span');
            buttonSpanIcon.className = 'glyphicon glyphicon-copy';
            var buttonSpanText = document.createElement('span');
            buttonSpanText.innerText = 'Copy';
            buttonSpanText.classList.add('copy');
    
            button.appendChild(buttonSpanIcon);
            button.appendChild(buttonSpanText);
        }
    
        function successCopyButtonState(button) {
            button.blur();
    
            button.innerText = '';
    
            var buttonSpanOkIcon = document.createElement('span');
            buttonSpanOkIcon.className = 'glyphicon glyphicon-ok';
    
            button.appendChild(buttonSpanOkIcon);
    
            button.classList.add('copy-success');
    
            setTimeout(function () {
                defaultCopyButtonState(button);
            }, 2000);
        }
    
        function identifyStatusCodes() {
            document.querySelectorAll('.endpoint code').forEach(function (e) {
                highlightStatusCodes(e);
            });
        }
    
        function highlightStatusCodes(el) {
    
            var codePrefix = el.innerText.substring(0,1);
            
            if (typeof codePrefix === 'undefined' || codePrefix == null) {
                return;
            }
    
            if (codePrefix == "2") {
                el.classList.add('code-success');
                return;
            }
    
            if (codePrefix == "3") {
                el.classList.add('code-warning');
                return;
            }
    
            if (codePrefix == "4" || codePrefix == "5") {
                el.classList.add('code-error');
                return;
            }
        }
    </script>  </body>
</html>
